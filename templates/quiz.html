<!DOCTYPE html>
<html>
<head>
    <title>Quiz</title>
    <style>
        #timer {
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <a href="/edit">Edit Questions</a>
    <a href="/settings">Settings</a>
    <div id="timer">Time Remaining: <span id="time">{{ '%02d:%02d' % (timer_duration // 60, timer_duration % 60) }}</span></div>
    <form id="quizForm">
        {% for question in questions %}
            <div>
                <p>{{ question.question }}</p>
                {% for option in json.loads(question.options) %}
                    <label>
                        <input type="radio" name="question{{ loop.index0 }}" value="{{ option }}">
                        {{ option }}
                    </label><br>
                {% endfor %}
            </div>
        {% endfor %}
        <button type="button" onclick="submitQuiz()">Submit</button>
    </form>
    <div id="result"></div>
    <script>
        let timeLeft = {{ timer_duration }};
        const timerElement = document.getElementById('time');

        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.innerText = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                submitQuiz();
            }
            timeLeft -= 1;
        }

        const timerInterval = setInterval(updateTimer, 1000);

        function submitQuiz() {
            const formData = new FormData(document.getElementById('quizForm'));
            const answers = [];
            for (let entry of formData.entries()) {
                answers.push(entry[1]);
            }
            fetch('/check_answers', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(answers)
            })
            .then(response => response.json())
            .then(data => {
                let resultHTML = `You scored ${data.score} out of ${data.total}<br><br>`;
                data.results.forEach(result => {
                    resultHTML += `<div>
                        <p><strong>Question:</strong> ${result.question}</p>
                        <p><strong>Your Answer:</strong> ${result.user_answer}</p>
                        <p><strong>Correct:</strong> ${result.correct ? 'Yes' : 'No'}</p>
                        <p><strong>Details:</strong> ${result.answer_details}</p>
                    </div><br>`;
                });
                document.getElementById('result').innerHTML = resultHTML;
            });
        }
    </script>
</body>
</html>
